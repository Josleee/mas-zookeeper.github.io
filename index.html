<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <!--<link rel="icon" href="assets/images/favicon.ico">-->

    <title>Zookeeper in Distributed System</title>

    <!-- Bootstrap core CSS -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="assets/css/dashboard.css" rel="stylesheet">

</head>

<body>
<nav class="navbar navbar-dark fixed-top bg-dark flex-md-nowrap p-0 shadow">
    <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="#">MAS - Zookeeper</a>
</nav>

<div class="container-fluid">
    <div class="row">
        <nav class="col-md-2 d-none d-md-block bg-light sidebar">
            <div class="sidebar-sticky">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link active" href="#tab1">
                            <span data-feather="home"></span>
                            Introduction <span class="sr-only">(current)</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#tab2">
                            <span data-feather="check-circle"></span>
                            Implementation
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#tab3">
                            <span data-feather="zap"></span>
                            Application
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#tab4">
                            <span data-feather="message-circle"></span>
                            Conclusion
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://github.com/Josleee/mas-zookeeper.github.io">
                            <span data-feather="github"></span>
                            Sources (on GitHub)
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#tab5">
                            <span data-feather="users"></span>
                            About
                        </a>
                    </li>
                </ul>
            </div>
        </nav>

        <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-4">
            <div class="main-content" id="tab1" style="display: none;">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3
            border-bottom">
                    <h1 class="h2">Introduction</h1>
                    <h1 class="h3">Zookeeper in Distributed System</h1>
                </div>
                <h5>Analysis of Zookeeper software for distributed systems</h5>
                <p>Apache ZooKeeper is a service used by distributed systems to coordinate between themselves and
                    maintain shared data with robust synchronization techniques. The processes in a zookeeper managed
                    cluster is managed by a leader. The leader node is selected from the list of nodes by election. The
                    rest of the nodes are called as followers. These are the servers which would be servicing the
                    clients. There is also a watcher node, which helps to detect failures and helps in new leader
                    election.</p>
                <p>Zookeeper mainly does two tasks:</p>
                <ol>
                    <li>Active Messaging:</li>
                    <p>In distributed systems, we have a group of servers each providing service to clients. The clients
                        have a list of servers they can connect to. They send a request to the server they want to
                        connect to, if the request is successful, the server sends an acknowledgement, if the connection
                        is refused by the server, the client tries to connect to a different server.</p>
                    <p>Each client can either send a data read request or a data write request. In the event of data
                        read request, the server will read the data from its copy of the database and sends the
                        response, or it sends an acknowledgement stating that the data was not present in the
                        database.</p>
                    <p>When the client sends a data write request, the server does not update the database im-
                        mediately. The write request is sent to the leader, the leader verifies whether the request is
                        genuine and then announces to all the servers in zookeeper to update their copies of the
                        database with the data that is to be written. The collection of servers in zookeeper is called a
                        quorum. If a sufficient number of servers respond back to the leaderâ€™s announcement, then the
                        write is permitted by the leader. This way the data is updated in all the servers copy of the
                        database. Once the write is successful, acknowledgement is sent to the client.</p>
                    <li>Leadership Election:</li>
                    <p>All the servers in zookeeper, create a sequential, ephemeral znode with the same path. The
                        zookeeper ensemble, appends a 10 digit sequence number to the path.Based on the config- uration,
                        the node with the smallest sequence number can be made as the leader.The rest of the nodes are
                        the followers. Each follower watches the node with the next smallest se- quence number.If the
                        leader fails, the watcher node sends a notification to the node which was watching the current
                        leader.This node then checks if there are any nodes with a lower sequence number then itself. If
                        it finds such a node, then that node is made as the next leader, else the same node is made as
                        the leader.
                    </p>
                </ol>
                <h5>Epistemic logic in Zookeeper</h5>
                <p>Using Epistemic logic, we can analyze the different functionalities of the software. We can also
                    analyze different situations of failures and how the software handles these situations.</p>
            </div>

            <div class="main-content" id="tab2" style="display: none;">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3
            border-bottom">
                    <h1 class="h2">Implementation</h1>
                    <h1 class="h3">Zookeeper in Distributed System</h1>
                </div>
            </div>

            <div class="main-content" id="tab3">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3
            border-bottom">
                    <h1 class="h2">Application</h1>
                    <h1 class="h3">Zookeeper in Distributed System</h1>
                </div>

                <div style="margin: 1em">
                    <button id="btn-init" type="button" class="btn btn-outline-secondary">Initialize</button>
                    <button id="btn-reset" type="button" class="btn btn-outline-secondary">Reset system</button>


                    <input type="range" min="1" max="5" value="3" class="slider" id="myRange">

                    <!--<input id="ex21" type="text"-->
                    <!--data-provide="slider"-->
                    <!--data-slider-ticks="[1, 2, 3]"-->
                    <!--data-slider-ticks-labels='["slow", "medium", "fast"]'-->
                    <!--data-slider-min="1"-->
                    <!--data-slider-max="3"-->
                    <!--data-slider-step="1"-->
                    <!--data-slider-value="2"-->
                    <!--data-slider-tooltip="hide"/>-->
                </div>

                <button id="btn-speed" type="button" class="btn btn-outline-secondary">Set speed</button>

                <div style="position: relative; width: 95em; height: 45em; /*border: 3px solid #73AD21;*/">
                    <button id="b1r" type="button" style="position: absolute; top: 7em; left: -1em"
                            class="btn btn-light">Read
                    </button>
                    <button id="b1w" type="button" style="position: absolute; top: 10em; left: -1em"
                            class="btn btn-light">Store
                    </button>
                    <button id="b2r" type="button" style="position: absolute; top: 16em; left: -1em"
                            class="btn btn-light">Read
                    </button>
                    <button id="b2w" type="button" style="position: absolute; top: 19em; left: -1em"
                            class="btn btn-light">Store
                    </button>
                    <button id="b3r" type="button" style="position: absolute; top: 24.7em; left: -1em"
                            class="btn btn-light">Read
                    </button>
                    <button id="b3w" type="button" style="position: absolute; top: 27.7em; left: -1em"
                            class="btn btn-light">Store
                    </button>

                    <img src="assets/images/icons/withID/c1.png" alt="client-computer" style="width:6.25em;height:6.25em;
                    position: absolute; top: 8em; left: 5em" id="c1">
                    <img src="assets/images/icons/withID/c2.png" alt="client-phone" style="width:6.25em;height:6.25em;
                    position: absolute; top: 18em; left: 5em" id="c2">
                    <img src="assets/images/icons/withID/c3.png" alt="client-computer" style="width:6.25em;height:6.25em;
                    position: absolute; top: 28em; left: 5em" id="c3">
                    <img src="assets/images/icons/withID/s1.png" alt="server" style="width:6.25em;height:6.25em;
                    position: absolute; top: 2em; left: 37.5em" id="s1">
                    <img src="assets/images/icons/withID/s2.png" alt="server" style="width:6.25em;height:6.25em;
                    position: absolute; top: 10em; left: 37.5em" id="s2">
                    <img src="assets/images/icons/withID/s3.png" alt="server" style="width:6.25em;height:6.25em;
                    position: absolute; top: 18em; left: 37.5em" id="s3">
                    <img src="assets/images/icons/withID/s4.png" alt="server" style="width:6.25em;height:6.25em;
                    position: absolute; top: 26em; left: 37.5em" id="s4">
                    <img src="assets/images/icons/withID/s5.png" alt="server" style="width:6.25em;height:6.25em;
                    position: absolute; top: 34em; left: 37.5em" id="s5">
                    <img src="assets/images/icons/withID/d1.png" alt="database" style="width:6.25em;height:6.25em;
                    position: absolute; top: 2em; left: 70em" id="d1">
                    <img src="assets/images/icons/withID/d2.png" alt="database" style="width:6.25em;height:6.25em;
                    position: absolute; top: 10em; left: 70em" id="d2">
                    <img src="assets/images/icons/withID/d3.png" alt="database" style="width:6.25em;height:6.25em;
                    position: absolute; top: 18em; left: 70em" id="d3">
                    <img src="assets/images/icons/withID/d4.png" alt="database" style="width:6.25em;height:6.25em;
                    position: absolute; top: 26em; left: 70em" id="d4">
                    <img src="assets/images/icons/withID/d5.png" alt="database" style="width:6.25em;height:6.25em;
                    position: absolute; top: 34em; left: 70em" id="d5">

                    <div id="bc1" style="position: absolute; top: 8em; left: 12em; width: 9em; height: 6em;
                    border: 2px dashed #73AD21; padding: 0.5em">
                        Kc(S1),...,Kc(S5)
                    </div>
                    <div id="bc2" style="position: absolute; top: 18em; left: 12em; width: 9em; height: 6em;
                    border: 2px dashed #73AD21; padding: 0.5em">
                        Kc(S1),...,Kc(S5)
                    </div>
                    <div id="bc3" style="position: absolute; top: 28em; left: 12em; width: 9em; height: 6em;
                    border: 2px dashed #73AD21; padding: 0.5em">
                        Kc(S1),...,Kc(S5)
                    </div>

                    <div id="bs1" style="position: absolute; top: 2em; left: 44.5em; width: 9em; height: 6em;
                    border: 2px dashed #73AD21; padding: 0.5em">
                        Ks(S1),...,Ks(S5)
                    </div>
                    <div id="bs2" style="position: absolute; top: 10em; left: 44.5em; width: 9em; height: 6em;
                    border: 2px dashed #73AD21; padding: 0.5em">
                        Ks(S1),...,Ks(S5)
                    </div>
                    <div id="bs3" style="position: absolute; top: 18em; left: 44.5em; width: 9em; height: 6em;
                    border: 2px dashed #73AD21; padding: 0.5em">
                        Ks(S1),...,Ks(S5)
                    </div>
                    <div id="bs4" style="position: absolute; top: 26em; left: 44.5em; width: 9em; height: 6em;
                    border: 2px dashed #73AD21; padding: 0.5em">
                        Ks(S1),...,Ks(S5)
                    </div>
                    <div id="bs5" style="position: absolute; top: 34em; left: 44.5em; width: 9em; height: 6em;
                    border: 2px dashed #73AD21; padding: 0.5em">
                        Ks(S1),...,Ks(S5)
                    </div>

                    <div id="bd1" style="position: absolute; top: 2em; left: 77em; width: 6em; height: 6em;
                    border: 2px dashed #73AD21; padding: 0.5em">
                        Kb(S1)
                    </div>
                    <div id="bd2" style="position: absolute; top: 10em; left: 77em; width: 6em; height: 6em;
                    border: 2px dashed #73AD21; padding: 0.5em">
                        Kb(S2)
                    </div>
                    <div id="bd3" style="position: absolute; top: 18em; left: 77em; width: 6em; height: 6em;
                    border: 2px dashed #73AD21; padding: 0.5em">
                        Kb(S3)
                    </div>
                    <div id="bd4" style="position: absolute; top: 26em; left: 77em; width: 6em; height: 6em;
                    border: 2px dashed #73AD21; padding: 0.5em">
                        Kb(S4)
                    </div>
                    <div id="bd5" style="position: absolute; top: 34em; left: 77em; width: 6em; height: 6em;
                    border: 2px dashed #73AD21; padding: 0.5em">
                        Kb(S5)
                    </div>

                    <div id="ns1" style="position: absolute; top: 7.5em; left: 38.75em; width: 6em; height: 3em;
                    border: 0px dashed #73AD21; padding: 0.5em" class="num-box">
                        /le/001
                    </div>
                    <div id="ns2" style="position: absolute; top: 15.5em; left: 38.75em; width: 6em; height: 3em;
                    border: 0px dashed #73AD21; padding: 0.5em" class="num-box">
                        /le/001
                    </div>
                    <div id="ns3" style="position: absolute; top: 23.5em; left: 38.75em; width: 6em; height: 3em;
                    border: 0px dashed #73AD21; padding: 0.5em" class="num-box">
                        /le/001
                    </div>
                    <div id="ns4" style="position: absolute; top: 31.5em; left: 38.75em; width: 6em; height: 3em;
                    border: 0px dashed #73AD21; padding: 0.5em" class="num-box">
                        /le/001
                    </div>
                    <div id="ns5" style="position: absolute; top: 39.5em; left: 38.75em; width: 6em; height: 3em;
                    border: 0px dashed #73AD21; padding: 0.5em" class="num-box">
                        /le/001
                    </div>

                    <div id="drawing"></div>
                    <svg height="45em" width="95em" id="svgsection">
                        <!--<path class="s1 d1 cnn" x1="54em" y1="5em" x2="69em" y2="5em"-->
                        <!--style="stroke:rgb(150,150,150);stroke-width:2px"></path>-->
                        <path class="s1 d1 cnn" stroke="rgb(150,150,150)" stroke-width="2px"
                              d="M760 70 L970 70 Z"></path>
                        <path class="s2 d2 cnn" stroke="rgb(150,150,150)" stroke-width="2px"
                              d="M760 180 L970 180 Z"></path>
                        <path class="s2 d3 cnn" stroke="rgb(150,150,150)" stroke-width="2px"
                              d="M760 290 L970 290 Z"></path>
                        <path class="s2 d4 cnn" stroke="rgb(150,150,150)" stroke-width="2px"
                              d="M760 400 L970 400 Z"></path>
                        <path class="s5 d5 cnn" stroke="rgb(150,150,150)" stroke-width="2px"
                              d="M760 510 L970 510 Z"></path>

                        <!--<path class="s2 d2 cnn" x1="54em" y1="13em" x2="69em" y2="13em"-->
                        <!--style="stroke:rgb(150,150,150);stroke-width:2px"></path>-->
                        <!--<path class="s3 d3 cnn" x1="54em" y1="21em" x2="69em" y2="21em"-->
                        <!--style="stroke:rgb(150,150,150);stroke-width:2px"></path>-->
                        <!--<path class="s4 d4 cnn" x1="54em" y1="29em" x2="69em" y2="29em"-->
                        <!--style="stroke:rgb(150,150,150);stroke-width:2px"></path>-->
                        <!--<path class="s5 d5 cnn" x1="54em" y1="37em" x2="69em" y2="37em"-->
                        <!--style="stroke:rgb(150,150,150);stroke-width:2px"></path>-->
                        <path class="s1 c1 cnn" stroke="rgb(150,150,150)" stroke-width="2px"
                              d="M300 150L 520 70"></path>
                        <path class="s2 c1 cnn" stroke="rgb(150,150,150)" stroke-width="2px"
                              d="M300 150L 520 186"></path>
                        <path class="s3 c1 cnn" stroke="rgb(150,150,150)" stroke-width="2px"
                              d="M300 150 L520 298 "></path>
                        <path class="s4 c1 cnn" stroke="rgb(150,150,150)" stroke-width="2px"
                              d="M300 150 L520 410 "></path>
                        <path class="s5 c1 cnn" stroke="rgb(150,150,150)" stroke-width="2px"
                              d="M300 150L 520 523"></path>

                        <!--<path class="s1 c1 cnn" x1="21.5em" y1="11em" x2="37em" y2="5em"-->
                        <!--style="stroke:rgb(150,150,150);stroke-width:2px"></path>-->
                        <!--<path class="s2 c1 cnn" x1="21.5em" y1="11em" x2="37em" y2="13em"-->
                        <!--style="stroke:rgb(150,150,150);stroke-width:2px"></path>-->
                        <!--<path class="s3 c1 cnn" x1="21.5em" y1="11em" x2="37em" y2="21em"-->
                        <!--style="stroke:rgb(150,150,150);stroke-width:2px"></path>-->
                        <!--<path class="s4 c1 cnn" x1="21.5em" y1="11em" x2="37em" y2="29em"-->
                        <!--style="stroke:rgb(150,150,150);stroke-width:2px"></path>-->
                        <!--<path class="s5 c1 cnn" x1="21.5em" y1="11em" x2="37em" y2="37em"-->
                        <!--style="stroke:rgb(150,150,150);stroke-width:2px"></path>-->

                        <!--<path class="s1 c2 cnn" x1="21.5em" y1="21em" x2="37em" y2="5em"-->
                        <!--style="stroke:rgb(150,150,150);stroke-width:2px"></path>-->
                        <!--<path class="s2 c2 cnn" x1="21.5em" y1="21em" x2="37em" y2="13em"-->
                        <!--style="stroke:rgb(150,150,150);stroke-width:2px"></path>-->
                        <!--<path class="s3 c2 cnn" x1="21.5em" y1="21em" x2="37em" y2="21em"-->
                        <!--style="stroke:rgb(150,150,150);stroke-width:2px"></path>-->
                        <!--<path class="s4 c2 cnn" x1="21.5em" y1="21em" x2="37em" y2="29em"-->
                        <!--style="stroke:rgb(150,150,150);stroke-width:2px"></path>-->
                        <!--<path class="s5 c2 cnn" x1="21.5em" y1="21em" x2="37em" y2="37em"-->
                        <!--style="stroke:rgb(150,150,150);stroke-width:2px"></path>-->

                        <path class="s1 c2 cnn" stroke="rgb(150,150,150)" stroke-width="2px"
                              d="M300 300 L520 70"></path>
                        <path class="s2 c2 cnn" stroke="rgb(150,150,150)" stroke-width="2px"
                              d="M300 300 L520 186"></path>
                        <path class="s3 c2 cnn" stroke="rgb(150,150,150)" stroke-width="2px"
                              d="M300 300 L520 298 "></path>
                        <path class="s4 c2 cnn" stroke="rgb(150,150,150)" stroke-width="2px"
                              d="M300 300 L520 410 "></path>
                        <path class="s5 c2 cnn" stroke="rgb(150,150,150)" stroke-width="2px"
                              d="M300 300 L520 523"></path>

                        <!--<path class="s1 c3 cnn" x1="21.5em" y1="31em" x2="37em" y2="5em"-->
                        <!--style="stroke:rgb(150,150,150);stroke-width:2px"></path>-->
                        <!--<path class="s2 c3 cnn" x1="21.5em" y1="31em" x2="37em" y2="13em"-->
                        <!--style="stroke:rgb(150,150,150);stroke-width:2px"></path>-->
                        <!--<path class="s3 c3 cnn" x1="21.5em" y1="31em" x2="37em" y2="21em"-->
                        <!--style="stroke:rgb(150,150,150);stroke-width:2px"></path>-->
                        <!--<path class="s4 c3 cnn" x1="21.5em" y1="31em" x2="37em" y2="29em"-->
                        <!--style="stroke:rgb(150,150,150);stroke-width:2px"></path>-->
                        <!--<path class="s5 c3 cnn" x1="21.5em" y1="31em" x2="37em" y2="37em"-->
                        <!--style="stroke:rgb(150,150,150);stroke-width:2px"></path>-->

                        <path class="s1 c3 cnn" stroke="rgb(150,150,150)" stroke-width="2px"
                              d="M300 450 L520 70"></path>
                        <path class="s2 c3 cnn" stroke="rgb(150,150,150)" stroke-width="2px"
                              d="M300 450 L520 186"></path>
                        <path class="s3 c3 cnn" stroke="rgb(150,150,150)" stroke-width="2px"
                              d="M300 450 L520 298 "></path>
                        <path class="s4 c3 cnn" stroke="rgb(150,150,150)" stroke-width="2px"
                              d="M300 450 L520 410 "></path>
                        <path class="s5 c3 cnn" stroke="rgb(150,150,150)" stroke-width="2px"
                              d="M300 450 L520 523"></path>

                        <path class="s1 s2 scnn" d="M 520 70 q -100 58 0 116" stroke="grey" stroke-width="2"
                              fill="none"></path>
                        <path class="s2 s3 scnn" d="M 520 186 q -100 56 0 112" stroke="grey" stroke-width="2"
                              fill="none"></path>
                        <path class="s3 s4 scnn" d="M 520 298 q -100 56 0 112" stroke="grey" stroke-width="2"
                              fill="none"></path>
                        <path class="s4 s5 scnn" d="M 520 410 q -100 56 0 112" stroke="grey" stroke-width="2"
                              fill="none"></path>
                        <path class="s3 s5 scnn" d="M 520 298 q -200 112 0 224" stroke="grey" stroke-width="2"
                              fill="none"></path>
                        <path class="s2 s4 scnn" d="M 520 186 q -200 112 0 224" stroke="grey" stroke-width="2"
                              fill="none"></path>
                        <path class="s1 s3 scnn" d="M 520 70 q -200 114 0 228" stroke="grey" stroke-width="2"
                              fill="none"></path>
                        <path class="s1 s4 scnn" d="M 520 70 q -300 171 0 342" stroke="grey" stroke-width="2"
                              fill="none"></path>
                        <path class="s2 s5 scnn" d="M 520 186 q -300 168 0 336" stroke="grey" stroke-width="2"
                              fill="none"></path>
                        <path class="s1 s5 scnn" d="M 520 70 q -400 225 0 450" stroke="grey" stroke-width="2"
                              fill="none"></path>

                        <!--<rect class="movingbox" x="50" y="20" width="100" height="35"-->
                        <!--style="fill:rgba(5,5,5,0.57);stroke:black;stroke-width:5;opacity:0.5"-->
                        <!--id="movingbox"></rect>-->
                        Sorry, your browser does not support inline SVG.
                    </svg>
                    <!--<img src="assets/images/spark.gif" alt="database" style="display:none;width:5em;height:5em;-->
                    <!--position: absolute; top: 50em; left: 50em" id="spark">-->
                </div>
            </div>

            <div class="main-content" id="tab4" style="display: none;">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3
            border-bottom">
                    <h1 class="h2">Conclusion</h1>
                    <h1 class="h3">Zookeeper in Distributed System</h1>
                </div>
            </div>

            <div class="main-content" id="tab5" style="display: none;">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3
            border-bottom">
                    <h1 class="h2">About</h1>
                    <h1 class="h3">Zookeeper in Distributed System</h1>
                </div>
                <p>This website offers a implementation of Zookeeper protocol with Kripke models. The model checker was
                    developed for the Multi Agent Systems course at the University of Groningen for the academic year of
                    2018/2019.</p>
                <p>Group members:</p>
                <ul>
                    <li>Arjun Harish</li>
                    <li>Yikun Li</li>
                    <li>Parth Tiwary</li>
                </ul>
            </div>
            <!--<canvas class="my-4 w-100" id="myChart" width="900" height="380"></canvas>-->
        </main>
    </div>
</div>

<!-- Bootstrap core JavaScript
================================================== -->

<!-- Placed at the end of the document so the pages load faster -->
<script>window.jQuery || document.write('<script src="assets/js/jquery-3.3.1.min.js"><\/script>')</script>
<script src="assets/js/popper.min.js"></script>
<script src="assets/js/bootstrap-slider.min.js"></script>
<link rel="stylesheet" type="text/css" href="assets/css/bootstrap-slider.min.css">
<link rel="stylesheet" type="text/css" href="assets/css/main.css">

<!-- Icons -->
<script src="assets/js/feather.min.js"></script>
<script>
    feather.replace()
</script>

<!-- Menu -->
<script>
    $(document).ready(function () {
        //  When user clicks on tab, this code will be executed
        $(".nav.flex-column li .nav-link").click(function () {
            //  First remove class "active" from currently active tab
            $(".nav.flex-column li .nav-link").removeClass('active');

            //  Now add class "active" to the selected/clicked tab
            $(this).addClass("active");

            //  Hide all tab content
            $(".main-content").hide();

            //  Here we get the href value of the selected tab
            // console.log(selected_tab);
            let selected_tab = $(this).attr("href");

            //  Show the selected tab content
            $(selected_tab).show();

            //  At the end, we add return false so that the click on the link is not executed
            return false;
        });
    });
</script>

<script src="assets/js/anime.min.js"></script>
<script>
    let le = ['/le/000', '/le/001', '/le/002', '/le/003', '/le/004'];
    let box_width = 80;
    let box_height = 35;
    let SENDING_TIME = 4000;

    let id = 1;

    let l_le = [];
    let client_connections = {
        1: -1,
        2: -1,
        3: -1,
    };
    let server_connections = {
        1: -1,
        2: -1,
        3: -1,
        4: -1,
        5: -1,
    };
    $('.cnn, .scnn, .num-box').hide();
    $('.d1, .d2, .d3, .d4, .d5').show();

    let svg = document.getElementsByTagName('svg')[6];


    $(document).ready(function () {
        //  When user clicks on tab, this code will be executed
        // let speed = $('#ex21').data('slider').options.value;

        $("#btn-reset").click(function () {
            $('.cnn, .scnn, .num-box').hide();
            $('.d1, .d2, .d3, .d4, .d5').show();
            le = ['/le/000', '/le/001', '/le/002', '/le/003', '/le/004'];
            $('.scnn').css('stroke', 'grey');
        });

        $("#btn-init").click(function () {
            shuffle(le);
            for (let i = 0; i < 5; i++) {
                $('#ns' + (i + 1)).text(le[i]);
            }

            l_le = analyse_label();
            $('.scnn.s' + l_le[0]).fadeIn(2000);
            $('.num-box').fadeIn(2000);

        });

        $("#b1r").click(function () {
            let flag = 0
            if (client_connections[1] != -1) {
                console.log('Find connection');
                // Send read request to c1c

            } else {
                //Client is free
                let list_server = [1, 2, 3, 4, 5];
                shuffle(list_server);


                for (let i = 0; i < list_server.length; i++) {
                    $('.cnn.c1.s' + list_server[i]).show();
                    client_connections[1] = list_server[i];
                    setTimeout(function () {
                        reqs_msg('c1', 's' + list_server[i], 'Con?')
                    }, 1000);
                    if (connect_server(1, list_server[i])) {
                        client_connections[1] = list_server[i];
                        setTimeout(function () {
                            reqs_msg('c1', 's' + list_server[i], 'Con?')
                        }, 1000);
                        setTimeout(function () {
                            resp_msg('c1', 's' + list_server[i], 'Ack')
                        }, 3500);
                        //Talk to the database
                        setTimeout(function () {
                            reqs_msg('s' + list_server[i], 'd' + list_server[i], 'Data')
                        }, 9500);
                        break;
                    }
                    else {
                        client_connections[1] = -1;
                        resp_msg('c1', 's' + list_server[i], 'NAck')
                        setTimeout(function () {
                        }, 3000)
                        continue;
                    }
                }
            }
        });

        $("#b2r").click(function () {
            if (client_connections[2] != -1) {
                console.log('Find connection');
                // Send read request to c1c

            } else {
                //Client is free
                let list_server = [1, 2, 3, 4, 5];
                shuffle(list_server);
                for (let i = 0; i < list_server.length; i++) {
                    $('.cnn.c2.s' + list_server[i]).show();
                    client_connections[2] = list_server[i];
                    setTimeout(function () {
                        reqs_msg('c2', 's' + list_server[i], 'Con?')
                    }, 1000);
                    if (connect_server(2, list_server[i])) {

                        setTimeout(function () {
                            resp_msg('c2', 's' + list_server[i], 'Ack')
                        }, 3500);
                        // Talk to the database
                        break;
                    } else {
                        //send nack
                        client_connections[2] = -1;
                        resp_msg('c2', 's' + list_server[i], 'NAck')
                        continue;
                    }
                }
            }
        });


        $("#b3r").click(function () {
            if (client_connections[3] != -1) {
                console.log('Find connection');
                // Send read request to c1c

            } else {
                //Client is free
                let list_server = [1, 2, 3, 4, 5];
                shuffle(list_server);
                for (let i = 0; i < list_server.length; i++) {
                    $('.cnn.c3.s' + list_server[i]).show();
                    if (connect_server(3, list_server[i])) {
                        client_connections[3] = list_server[i];
                        setTimeout(function () {
                            reqs_msg('c3', 's' + list_server[i], 'Con?')
                        }, 1000);
                        setTimeout(function () {
                            resp_msg('c3', 's' + list_server[i], 'Ack')
                        }, 3500);
                        //Send Heartbeats
                        break;
                    } else {
                        //negative ack
                        client_connections[3] = -1;
                        resp_msg('c3', 's' + list_server[i], 'NAck')
                        continue;
                    }
                }
            }
        });
        // With JQuery
        $("#ex21").slider();
        $('#btn-speed').on("click", function () {
            speed = $('#ex21').data('slider').options.value;
            console.log(speed)
        });
    })
    ;


    function reqs_msg(scr, dst, message) {
        let local_id = id;
        id += 1;
        console.log('.cnn.' + scr + '.' + dst)
        let path = anime.path('.cnn.' + scr + '.' + dst);
        let box = create_box(local_id, message);
        let motionPath = anime({
            targets: box,
            translateX: path('x'),
            translateY: path('y'),
            rotate: path('angle'),
            easing: 'linear',
            loop: 1,
            duration: SENDING_TIME,
            complete: function () {
                delete_box(local_id);
            }
        });

    }

    function resp_msg(scr, dst, message) {
        let local_id = id;
        id += 1;

        let path = anime.path('.cnn.' + scr + '.' + dst);
        let box2 = create_box(local_id, message);
        let motionPath2 = anime({
            targets: box2,
            translateX: path('x'),
            translateY: path('y'),
            rotate: path('angle'),
            easing: 'linear',
            loop: 1,
            duration: SENDING_TIME,
            direction: 'reverse',
            complete: function () {
                delete_box(local_id);
                if (message != 'NAck') {
                    (function () {
                        heartbeats(scr, dst, 'Alive')
                        setTimeout(arguments.callee, 6000);
                    })();
                } else {
                    $('.cnn.' + scr + '.' + dst).hide()
                }
            }
        });
    }


    function delete_box(id) {
        $("#movingbox" + id).remove();
        $("#textbox" + id).remove();
    }

    function create_box(id, ctn) {
        let rect = document.createElementNS("http://www.w3.org/2000/svg", 'rect');
        rect.setAttribute('x', -box_width / 2);
        rect.setAttribute('y', -box_height / 2);
        rect.setAttribute('width', box_width);
        rect.setAttribute('height', box_height);
        rect.setAttribute('fill', 'rgba(121,121,121,1)');
        rect.setAttribute('stroke-width', '0');
        rect.setAttribute('opacity', '1');
        rect.setAttribute('id', 'movingbox' + id);

        let text = document.createElementNS("http://www.w3.org/2000/svg", 'text');
        text.setAttribute('x', -box_width / 3);
        text.setAttribute('y', box_height / 5);
        text.setAttribute('width', box_width);
        text.setAttribute('height', box_height);
        text.setAttribute('fill', 'rgba(255,255,255,1)');
        text.setAttribute('stroke-width', '0');
        text.setAttribute('class', 'textbox');
        text.setAttribute('opacity', '1');
        text.setAttribute('id', 'textbox' + id);
        text.innerHTML = ctn;

        svg.appendChild(rect);
        svg.appendChild(text);

        return [rect, text]
    }

    function connect_server(Cnum, Snum) {
//        check for existing connections and accept only if free.
        if (server_connections[Snum] == -1) {
            // Server is free
            server_connections[Snum] = Cnum;
            console.log(true)
            return true;
        }
        else {
            //Server is busy
            console.log(false)
            return false
        }
    }

    function heartbeats(scr, dst, message) {
        let local_id = id;
        id += 1;
        let path = anime.path('.cnn.' + scr + '.' + dst);
        let box = create_box(local_id, message);
        let motionPath = anime({
            targets: box,
            translateX: path('x'),
            translateY: path('y'),
            rotate: path('angle'),
            easing: 'linear',
            loop: 1,
            duration: SENDING_TIME,
            complete: function () {
                delete_box(local_id);
            }
        });
    }

    function analyse_label() {
        let tmp = [];
        let c_le = le.slice();
        while (true) {
            let inv_count = 0;
            for (let i = 0; i < c_le.length; i++) {
                if ('invalid' == c_le[i]) {
                    inv_count += 1;
                }
            }
            if (inv_count == c_le.length) {
                break;
            }

            let ms = 999;
            let ind = -1;
            for (let i = 0; i < c_le.length; i++) {
                if ('invalid' == c_le[i]) {
                    continue;
                }

                if (ms >= parseInt(c_le[i].slice(-1))) {
                    ms = parseInt(c_le[i].slice(-1));
                    ind = i
                }
            }
            c_le[ind] = 'invalid';
            tmp.push(ind + 1);
        }

        for (let i = 1; i < tmp.length; i++) {
            $('.scnn.s' + tmp[i - 1] + '.s' + tmp[i]).fadeIn(2000);
            $('.scnn.s' + tmp[i - 1] + '.s' + tmp[i]).css('stroke', '#3d9aff');
        }
        return tmp;
    }

    /**
     * Shuffles array in place.
     * @param {Array} a items An array containing the items.
     */
    function shuffle(a) {
        let j, x, i;
        for (i = a.length - 1; i > 0; i--) {
            j = Math.floor(Math.random() * (i + 1));
            x = a[i];
            a[i] = a[j];
            a[j] = x;
        }
        return a;
    }

</script>

</body>
</html>
